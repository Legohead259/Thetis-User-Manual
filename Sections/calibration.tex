\section{Calibration}
\label{sec:calibration}

Each Thetis instrumentation board is calibrated during production to achieve the specified accuracy.
The calibration process uses custom equipment and open-source algorithms to calculate calibration parameters specific to each Thetis board.
See Chapter 4 in the thesis for more information.
Calibration is performed at room temperature.
Accuracy will be reduced for operating temperatures that deviate from this temperature.

\subsection{Inertial sensors}
\label{sec:inertialSensor}

The inertial sensors are the gyroscope and accelerometer which are packaged within the STdevices LSM6DSO32.
Each inertial sensor is calibrated for axis sensitivity, axis offset, inter-axis misalignment, and package misalignment.
The inertial calibration model is described by \Fref{eq:inertial} where $\pmb{i}_c$ is the calibrated inertial measurement obtained from the uncalibrated inertial measurement, $\pmb{i}_u$, given the misalignment matrix, $M$, the sensitivity diagonal matrix, $S$, and the offset vector, $\pmb{b}$.
The inertial calibration model is expanded as \Fref{eq:inertialExpanded} to express the model as 15 scalar quantities.  
The units of $\pmb{i}_c$, $\pmb{i}_u$, and $\pmb{b}$ are degrees per second for the gyroscope, and g for the accelerometer.
$M$ and $S$ are ratios and therefore have no units.  
The calibration parameters $M$, $S$, and $\pmb{b}$ for each inertial sensor can be accessed as device settings.

\begin{equation}
    \label{eq:inertial}
    \pmb{i}_c = M S (\pmb{i}_u - \pmb{b})
\end{equation}

\begin{equation}
    \label{eq:inertialExpanded}
    \begin{bmatrix}
        i_{cx}\\
        i_{cy}\\
        i_{cz}\\
    \end{bmatrix}
    =
    \begin{bmatrix}
        m_{xx} & m_{xy} & m_{xz}\\
        m_{yx} & m_{yy} & m_{yz}\\
        m_{zx} & m_{zy} & m_{zz}\\
    \end{bmatrix}
    \begin{bmatrix}
        s_{x} & 0 & 0\\
        0 & s_{y} & 0\\
        0 & 0 & s_{z}\\
    \end{bmatrix}
    \left(
    \begin{bmatrix}
        i_{ux}\\
        i_{uy}\\
        i_{uz}\\
    \end{bmatrix}
    -
    \begin{bmatrix}
        b_{x}\\
        b_{y}\\
        b_{z}\\
    \end{bmatrix}
    \right)
\end{equation}

\subsection{Magnetometer}
\label{sec:magnetometer}

The magnetometer is calibrated for soft and hard iron distortion.
Soft iron characteristics are distortions that alter the intensity and direction of the magnetic field measured by the magnetometer.
Soft iron calibration also accounts for magnetometer axis sensitivity, inter-axis misalignment, and package misalignment.  
Hard iron characteristics are unintended magnetic fields generated by the device that offset magnetometer measurements.  
Hard iron calibration also accounts for the magnetometer axis offset.

The magnetometer calibration model is described by \Fref{eq:magnetometer} where $\pmb{m}_c$ is the calibrated magnetometer measurement obtained from the uncalibrated magnetometer measurement, $\pmb{m}_u$, given the soft iron matrix, $W^{-1}$, the hard iron vector, $\pmb{v}$.  
The magnetometer calibration model is expanded as \Fref{eq:magnetometerExpanded} to express the model as 12 scalar quantities.
The units of $\pmb{m}_c$, $\pmb{m}_u$, and $\pmb{v}$ are \ac{a.u.}.  
$W^{-1}$ is a ratio and therefore has no units.  
The calibration parameters $W^{-1}$, $\pmb{v}$ can be accessed as device settings.

\begin{equation}
    \label{eq:magnetometer}
    \pmb{m}_c = W^{-1} \pmb{b}_u - \pmb{v}
\end{equation}

\begin{equation}
\label{eq:magnetometerExpanded}
    \begin{bmatrix}
        m_{c,x}\\
        m_{c,y}\\
        m_{c,z}\\
    \end{bmatrix}
    =
    \begin{bmatrix}
        w_{xx} & w_{xy} & w_{xz}\\
        w_{yx} & w_{yy} & w_{yz}\\
        w_{zx} & w_{zy} & w_{zz}\\
    \end{bmatrix}
    \begin{bmatrix}
        m_{u,x}\\
        m_{u,y}\\
        m_{u,z}\\
    \end{bmatrix}
    -
    \begin{bmatrix}
        v_{x}\\
        v_{y}\\
        v_{z}\\
    \end{bmatrix}
\end{equation}
